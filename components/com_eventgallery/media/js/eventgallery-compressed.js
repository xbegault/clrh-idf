var SizeCalculator=new Class({Implements:[Options],options:{availableSizes:new Array(32,48,64,72,94,104,110,128,144,150,160,200,220,288,320,400,512,576,640,720,800,912,1024,1152,1280,1440)},getSize:function(c,a,b){var d=this.options.availableSizes[0];this.options.availableSizes.each(function(i,f){if(d>32){return}var h=f==this.options.availableSizes.length-1;if(b>=1){var e=i>c;var g=i/b>a;if((e&&g)||h){d=i}}else{var g=i>a;var e=i*b>c;if((e&&g)||h){d=i}}}.bind(this));return d},adjustImageURL:function(a,b){a=a.replace(/width=(\d*)/,"width="+b);a=a.replace(/\/s(\d*)\//,"/s"+b+"/");a=a.replace(/\/s(\d*)-c\//,"/s"+b+"-c/");return a}});var EventgalleryToolbox=new Class({calcBorderWidth:function(f,c){var d=0;for(var b=0;b<f.length;b++){for(var a=0;a<c.length;a++){var e=f[b].getStyle(c[a]).toInt();if(!isNaN(e)){d+=e}}}return d}});var EventgalleryImage=new Class({Extends:EventgalleryToolbox,Implements:[Options],options:{maxImageHeight:800},initialize:function(c,b,a){this.setOptions(a);this.tag=c;this.index=b;this.calcSize()},calcSize:function(){var b=this.tag.getElement("img");if(b==null){return}var a=[this.tag,b];this.glueLeft=this.calcBorderWidth(a,["padding-left","margin-left","border-width"]);this.glueRight=this.calcBorderWidth(a,["padding-right","margin-right","border-width"]);this.glueTop=this.calcBorderWidth(a,["padding-top","margin-top","border-width"]);this.glueBottom=this.calcBorderWidth(a,["padding-bottom","margin-bottom","border-width"]);this.width=b.getProperty("data-width").toInt();this.height=b.getProperty("data-height").toInt();if(this.width==null){this.width=this.tag.getSize().x-this.glueLeft-this.glueRight}if(this.height==null){this.height=this.tag.getSize().y-this.glueTop-this.glueBottom}},setSize:function(b,j){if(j>this.options.maxImageHeight){b=Math.round(b/j*this.options.maxImageHeight);j=this.options.maxImageHeight}var d=b-this.glueLeft-this.glueRight;var a=j-this.glueTop-this.glueBottom;if(this.width<d){d=this.width}if(this.height<a){a=this.height}var h=this.width/this.height;var e=new SizeCalculator();var f=e.getSize(d,a,h);var c=this.tag.getElement("img");if(c==null){return}var i=c.getStyle("background-image");var g=c.getAttribute("longDesc");if(!g){g=""}i=e.adjustImageURL(i,f);g=e.adjustImageURL(g,f);c.setStyle("background-image",i);c.set("longDesc",g);c.setStyle("background-position","50% 50%");c.setStyle("background-repeat","no-repeat");c.setStyle("display","block");c.setStyle("margin","auto");if(d>0){c.setStyle("width",d)}if(a>0){c.setStyle("height",a)}}});var EventgalleryRow=new Class({Implements:[Options],options:{maxWidth:960,maxHeight:150,heightJitter:0,adjustHeight:true,cropLastImage:true},initialize:function(a){this.setOptions(a);this.images=new Array();this.width=0;if(this.options.heightJitter>0){this.options.maxHeight=Math.floor(this.options.maxHeight+(Math.random()*2*this.options.heightJitter)-this.options.heightJitter)}},add:function(b){var a=Math.floor(b.width/b.height*this.options.maxHeight);if(this.width+a<=this.options.maxWidth||this.images.length==0){this.images.push(b);this.width=this.width+a;return true}else{return false}},processRow:function(b){var g=this.options.maxWidth-this.width;var c=Math.floor(g/this.images.length);if(c>this.options.rowWidth/this.images.length){c=0}var d=Math.floor(g/this.images.length);if(this.options.adjustHeight==false){d=0}if(d<0){d=0}var f=g-(c*(this.images.length-1));if((this.images.length==1&&!this.options.cropLastImage)||(b&&this.images.length==1&&this.images[0].height<this.images[0].width)){var e=this.images[0];var a=Math.round(e.height/e.width*this.options.maxWidth);e.setSize(this.options.maxWidth,a)}else{this.images.each(function(j,i){var h=Math.floor(j.width/j.height*this.options.maxHeight);if(i==this.images.length-1){j.setSize(h+f,this.options.maxHeight+d)}else{j.setSize(h+c,this.options.maxHeight+d)}}.bind(this))}}});var EventgalleryImagelist=new Class({Implements:[Options],options:{rowHeightPercentage:100,rowHeight:150,rowHeightJitter:0,minImageWidth:150,cropLastImage:true,imagesetContainer:null,imageset:null,firstImageRowHeight:2,initComplete:function(){},resizeStart:function(){},resizeComplete:function(){}},images:Array(),eventgalleryPageWidth:0,width:null,initialize:function(b){this.setOptions(b);this.width=this.options.imagesetContainer.getSize().x;var a=this.options.imageset;this.images=Array();a.each(function(d,c,e){this.images.push(new EventgalleryImage(d,c))}.bind(this));window.addEvent("resize",function(){window.clearTimeout(this.eventgalleryTimer);this.eventgalleryTimer=(function(){var c=this.options.imagesetContainer.getSize().x;this.width=c;if(this.eventgalleryPageWidth!=c){this.options.resizeStart();this.eventgalleryPageWidth=c;this.processList();this.options.resizeComplete()}}.bind(this)).delay(500)}.bind(this));this.options.imagesetContainer.setStyle("min-height",this.options.rowHeight*this.images.length);this.processList();this.options.imagesetContainer.setStyle("min-height","0px");this.options.initComplete()},getRowWidth:function(){var a=this.width;if(window.getComputedStyle){a=Math.floor(window.getComputedStyle(this.options.imagesetContainer).width.toFloat())-1}else{a=a-1}return a},processList:function(){var b=this.getRowWidth();var e=Array.clone(this.images);if(this.options.firstImageRowHeight>1){var f=e.shift();f.tag.setStyle("display","none");b=this.getRowWidth();f.tag.setStyle("display","block");var a=this.options.firstImageRowHeight*this.options.rowHeight;var c=Math.floor(f.width/f.height*a);if(c+this.options.minImageWidth>=b){c=b;rowsLeft=0}f.setSize(c,a);var d={maxWidth:b-c,maxHeight:this.options.rowHeight,adjustHeight:false};if(d.maxWidth>0){this.generateRows(e,this.options.firstImageRowHeight,d,false)}}var d={maxWidth:b,maxHeight:this.options.rowHeight,heightJitter:this.options.rowHeightJitter,cropLastImage:this.options.cropLastImage};this.generateRows(e,99999,d,true)},generateRows:function(e,f,c,a){var b=new EventgalleryRow(c);while(e.length>0&&f>0){var d=b.add(e[0]);if(d){e.shift()}else{b.processRow(a);f--;if(f==0){break}b=new EventgalleryRow(c)}}b.processRow(a)}});var EventgalleryEventsList=new Class({Extends:EventgalleryImagelist,Implements:[Options],processList:function(){var a=this.width;this.images.each(function(c){var b=Math.ceil(a*this.options.rowHeightPercentage/100);c.setSize(a,b)}.bind(this))}});var EventgalleryEventsTiles=new Class({Extends:EventgalleryImagelist,eventgalleryTilesCollection:null,processList:function(){var a=this.width;this.images.each(function(d){var b=Math.round(d.height/d.width*a);var c=a;if(this.options.adjustMode=="height"&&d.height>d.width){b=a;c=Math.round(d.width/d.height*b)}d.setSize(c,b)}.bind(this))}});var EventgalleryGridCollection=new Class({Extends:EventgalleryToolbox,Implements:[Options],options:{tilesSelector:"#events-tiles .event",tilesContainerSelector:"#events-tiles .event-tiles",thumbSelector:".event-thumbnail",thumbContainerSelector:".event-thumbnails"},tiles:null,tilesContainer:null,initialize:function(a){this.setOptions(a);this.tiles=$$(this.options.tilesSelector);this.tilesContainer=$$(this.options.tilesContainerSelector)},calculate:function(){var e=1;this.tiles.setStyles({visibility:"hidden",position:"static","float":"left"});var g=this.tiles[0].getPosition().y;for(var c=1;c<this.tiles.length;c++){if(this.tiles[c].getPosition().y!=g){break}e++}var d=this.tiles[0].getSize().x;var b=0;var a=0;this.tiles.each(function(h){h.setStyle("left",b*d);h.setStyle("top",a*d);h.setStyle("height",d);b++;if(b+1>e){b=0;a++}}.bind(this));this.tiles.each(function(l){var k=l.getElements(this.options.thumbSelector)[0];var o=l.getElements(this.options.thumbContainerSelector)[0];var m=l.getSize();var j=k.getSize();var n=m.x-this.calcBorderWidth([l],["padding-right","margin-right","border-width","padding-left","margin-left","border-width"]);var i=Math.floor((n-j.x)/2);var h=Math.floor((m.y-j.y)/2);o.setAttribute("data-adjust-x",i);o.setAttribute("data-adjust-y",h)}.bind(this));this.tiles.each(function(h){var i=h.getElements(this.options.thumbContainerSelector)[0];i.setStyle("left",i.getAttribute("data-adjust-x")+"px");i.setStyle("top",i.getAttribute("data-adjust-y")+"px")}.bind(this));var f=Math.ceil(this.tiles.length/e)*d;this.tilesContainer.setStyle("height",f);this.tiles.setStyles({visibility:"visible",position:"absolute","float":"none"})}});var EventgalleryTilesCollection=new Class({Implements:[Options],options:{tilesSelector:"#events-tiles .event",tilesContainerSelector:"#events-tiles .event-tiles"},tiles:null,tilesContainer:null,initialize:function(a){this.setOptions(a);this.tiles=$$(this.options.tilesSelector);this.tilesContainer=$$(this.options.tilesContainerSelector)},calculate:function(){var c=1;this.tiles.each(function(f){f.setStyle("visibility","hidden");f.setStyle("position","static");f.setStyle("float","left")});var e=this.tiles[0].getPosition().y;for(var a=1;a<this.tiles.length;a++){if(this.tiles[a].getPosition().y!=e){break}c++}var d=[];for(var a=0;a<c;a++){d.push(0)}var b=this.tiles[0].getSize().x;this.tiles.each(function(g){var f=this.getSmallestColumn(d);g.setStyle("left",f*b);g.setStyle("top",d[f]);d[f]=d[f]+g.getSize().y}.bind(this));this.tiles.each(function(f){f.setStyle("visibility","visible");f.setStyle("position","absolute");f.setStyle("float","none")});this.tilesContainer.setStyle("height",d[this.getHighestColumn(d)])},getSmallestColumn:function(d){var b=d[0];var c=0;for(var a=0;a<d.length;a++){if(b>d[a]){b=d[a];c=a}}return c},getHighestColumn:function(c){var d=c[0];var a=0;for(var b=0;b<c.length;b++){if(d<c[b]){d=c[b];a=b}}return a}});var EventgalleryCart=new Class({Implements:[Options],cart:new Array(),options:{buttonShowType:"block",emptyCartSelector:".eventgallery-cart-empty",cartSelector:".eventgallery-ajaxcart",cartItemContainerSelector:".cart-items-container",cartItemsSelector:".eventgallery-ajaxcart .cart-items",cartItemSelector:".eventgallery-ajaxcart .cart-items .cart-item",cartCountSelector:".itemscount",buttonDownSelector:".toggle-down",buttonUpSelector:".toggle-up",cartItemsMinHeight:null,removeUrl:"",add2cartUrl:"",getCartUrl:"",removeLinkTitle:"Remove"},initialize:function(a){this.setOptions(a);this.myVerticalSlide=new Fx.Tween($$(this.options.cartItemContainerSelector).getLast(),{duration:"short",transition:"quad:in",link:"cancel",property:"height"});$$(this.options.buttonDownSelector).addEvent("click",function(b){b.stop();this.myVerticalSlide.start($$(this.options.cartItemsSelector).getLast().getSize().y);$$(this.options.buttonDownSelector).setStyle("display","none");$$(this.options.buttonUpSelector).setStyle("display",this.options.buttonShowType)}.bind(this));$$(this.options.buttonUpSelector).addEvent("click",function(b){b.stop();this.myVerticalSlide.start(this.options.cartItemsMinHeight);$$(this.options.buttonUpSelector).setStyle("display","none");$$(this.options.buttonDownSelector).setStyle("display",this.options.buttonShowType)}.bind(this));$(document.body).removeEvents("click:relay(.eventgallery-add2cart)");$(document.body).addEvent("click:relay(.eventgallery-add2cart)",function(b){this.add2cart(b)}.bind(this));$(document.body).removeEvents("click:relay(.eventgallery-add-all)");$(document.body).addEvent("click:relay(.eventgallery-add-all)",function(b){this.addAll2cart(b)}.bind(this));$(document.body).removeEvents("click:relay(.eventgallery-removeFromCart)");$(document.body).addEvent("click:relay(.eventgallery-removeFromCart)",function(b){this.removeFromCart(b)}.bind(this));$(document.body).addEvent("updatecartlinks",function(b){this.populateCart(true)}.bind(this));$(document.body).addEvent("updatecart",function(b){this.cart=b.cart;this.populateCart(false)}.bind(this));this.updateCart()},updateCartItemContainer:function(){var b=false;var d=-1;$$(this.options.cartItemSelector).each(function(e){var f=e.getPosition().y;if(d<0){d=f}else{if(d!=f){b=true}}}.bind(this));if(b){var c=$$(this.options.buttonDownSelector);var a=$$(this.options.buttonUpSelector);if(c.getStyle("display")=="none"&&a.getStyle("display")=="none"){c.setStyle("display",this.options.buttonShowType)}else{if(a.getStyle("display")!="none"){setTimeout(function(){this.myVerticalSlide.stop();this.myVerticalSlide.start($$(this.options.cartItemsSelector).getLast().getSize().y)}.bind(this),1000)}}}else{this.myVerticalSlide.start(this.options.cartItemsMinHeight);$$(this.options.buttonUpSelector).setStyle("display","none");$$(this.options.buttonDownSelector).setStyle("display","none")}},populateCart:function(b){var a=new Fx.Slide($$(this.options.cartSelector)[0],{resetHeight:true});if(this.cart.length==0){a.slideOut();$$(this.options.emptyCartSelector).setStyle("display","block")}else{$$(this.options.cartSelector).setStyle("display","block");a.slideIn();$$(this.options.emptyCartSelector).setStyle("display","none")}var d=$$(this.options.cartItemsSelector).getLast();if(d==null){return}if(!b){d.set("html","")}$$("a.eventgallery-add2cart").addClass("button-add2cart").removeClass("button-alreadyInCart");for(var c=this.cart.length-1;c>=0;c--){var e="folder="+this.cart[c].folder+"&file="+this.cart[c].file;if(!b){d.set("html",d.get("html")+'<div class="cart-item"><span class="badge">'+this.cart[c].count+"</span>"+this.cart[c].imagetag+'<a href="#" title="'+this.options.removeLinkTitle+'" class="eventgallery-removeFromCart button-removeFromCart" data-id="lineitemid='+this.cart[c].lineitemid+'"><i class="big"></i></a></div>')}$$('a.eventgallery-add2cart[data-id="'+e+'"]').addClass("button-alreadyInCart").removeClass("button-add2cart")}if(!b){d.set("html",d.get("html")+'<div style="clear:both"></div>');if(null==this.options.cartItemsMinHeight){this.options.cartItemsMinHeight=$$(this.options.cartItemContainerSelector).getLast().getSize().y}this.updateCartItemContainer()}$$(".itemscount").set("html",this.cart.length);EventGalleryMediabox.scanPage()},updateCart:function(){var a=new Request.JSON({url:this.options.getCartUrl,method:"post",data:{json:"yes"},onComplete:function(b){if(b!==undefined){$(document.body).fireEvent("updatecart",{target:null,cart:b,stop:function(){},preventDefault:function(){},stopPropagation:function(){}})}}.bind(this)}).send()},removeFromCart:function(a){return this.doRequest(a,this.options.removeUrl)},add2cart:function(b){var a=$$("input:checked[name=currentimagetype]");if(a.length>0){if(b.target.tagName=="A"){linkElement=$(b.target)}else{linkElement=$(b.target).getParent("A")}var c=linkElement.getAttribute("data-id");c=c+"&imagetypeid="+a[0].value;return this.doRequest(b,this.options.add2cartUrl,c)}else{return this.doRequest(b,this.options.add2cartUrl)}},addAll2cart:function(c){var b=$$("input:checked[name=currentimagetype]");var a=[];$$(".eventgallery-add2cart").each(function(d){$(document.body).fireEvent("click:relay(.eventgallery-add2cart)",{target:d,stop:function(){},preventDefault:function(){},stopPropagation:function(){}})})},doRequest:function(g,c,h){var b;if(g.target.tagName=="A"){b=$(g.target)}else{b=$(g.target).getParent("A")}var f=b.getChildren("i").getLast();if(h==undefined){var h=b.getAttribute("data-id")}var a=$$("input:checked[name=currentimagetype]")[0];f.addClass("loading");var e="";if(b.hasClass("btn-primary")){e="btn-primary";b.removeClass(e);b.addClass("btn-info")}var d=new Request.JSON({url:c,method:"POST",data:h,onComplete:function(i){if(i!==undefined){$(document.body).fireEvent("updatecart",{target:null,cart:i,stop:function(){},preventDefault:function(){},stopPropagation:function(){}})}f.removeClass("loading");if(e.length>0){b.removeClass("btn-info");b.addClass("btn-success");setTimeout(function(){b.removeClass("btn-success");b.addClass(e)}.bind(this),2000)}}.bind(this)}).send();g.stopPropagation();g.preventDefault();return true}});window.addEvent("domready",function(){$(document.body).addEvent("click:relay(a.social-share-button-close)",function(c){c.preventDefault();var b=$(c.target).getParent(".social-sharing-toolbox");var a=new Fx.Tween(b,{property:"opacity",onComplete:function(){b.dispose()}});a.start(0)});$(document.body).addEvent("click:relay(a.social-share-button-open)",function(g){g.preventDefault();var f=$(g.target);if(!f.getAttribute("data-link")){f=f.getParent("a")}var i="id_"+Math.ceil(Math.random()*10000000);var d=$(g.target).getPosition();var b=new Element("div",{href:"#","class":"social-sharing-toolbox",html:"Loading",id:i,styles:{opacity:"1 !important",position:"absolute",top:d.y-10,left:d.x-10,opacity:0}});$$("body")[0].grab(b);b.fade("in");b.set("load",{evalScripts:true});b.load(f.getAttribute("data-link"));var h=null;var a=function(){var e=new Fx.Tween(b,{property:"opacity",onComplete:function(){b.dispose()}});e.start(0);$$("body").removeEvent("click",c)};b.addEvent("mouseleave",function(){h=window.setTimeout(a,1000)}.bind(this));b.addEvent("mouseenter",function(){window.clearTimeout(h)}.bind(this));var c=function(j){if(j.target.id!=i&&$(j.target).getParent("#"+i)==null){a()}}.bind(this);$$("body").addEvent("click",c)})});