var $defined=function(a){return(a!=undefined)};var JSGallery2=new Class({Implements:Options,options:{selectSpeed:200,fadeSpeed:250,pageSpeed:1000,prevHandle:null,nextHandle:null,countHandle:null,titleTarget:null,initialIndex:-1,maxOpacity:0.8,next_image:"next_image.png",prev_image:"prev_image.png",showSocialMediaButton:true,showCartButton:true,showCartConnector:false,cartConnectorLinkRel:"",activeClass:"thumbnail-active",loadingClass:"thumbnail-loading",lightboxRel:"lightbo2"},initialize:function(b,g,h,f){var a=h.getChildren("div");this.currentPageNumber=0;this.loadedImages=0;this.blockKeys=false;this.imagesPerFirstPage=a[0].getChildren("div.thumbnail").length;this.imagesPerPage=this.imagesPerFirstPage;if(a.length>1&&a[1].getChildren("div.thumbnail").length>0){this.imagesPerPage=a[1].getChildren("div.thumbnail").length}this.setOptions(f);this.thumbs=b;this.bigImage=g;this.pageContainer=h;this.convertThumbs();this.lastPage=Math.ceil((this.thumbs.length-this.imagesPerFirstPage)/this.imagesPerPage)+1;var e=document.location;var d=e.toString().split("#");this.initialIndex=0;if(d.length>0){var c=/(^\d\d*$)/;if(c.test(d[1])==true){this.initialIndex=d[1]}}this.createControls();this.gotoPage(0);if(this.options.initialIndex!=-1){this.unBlockKeys();this.selectByIndex(this.options.initialIndex)}else{if(this.initialIndex!=0){this.unBlockKeys();this.selectByIndex(this.initialIndex)}}this.loadNextImage()},createControls:function(){this.prevLink=new Element("a",{events:{click:this.prevImage.bind(this),mouseleave:this.mouseLeaveHandler.bind(this)},styles:{width:"63px",display:"block",top:"0px",position:"absolute",height:"100%",background:"url("+this.options.prev_image+") no-repeat 0 50%"},href:"#","class":"link"}).inject(this.bigImage.getParent());this.prevLink.addEvent("mouseover",function(a){this.focusControl(a,this.prevLink)}.bind(this));this.zoomLink=this.prevLink.clone().inject(this.prevLink,"after").set({events:{click:this.zoomImage.bind(this),mouseleave:this.mouseLeaveHandler.bind(this)},styles:{width:"80%",left:"70px","background-image":"url("+this.options.zoom_image+")","background-position":"50% 50%"},rel:this.options.lightboxRel});this.zoomLink.addEvent("mouseover",function(a){this.focusControl(a,this.zoomLink)}.bind(this));this.nextLink=this.prevLink.clone().inject(this.zoomLink,"after").set({events:{click:this.nextImage.bind(this),mouseleave:this.mouseLeaveHandler.bind(this)},styles:{right:"0px","background-image":"url("+this.options.next_image+")"}});this.prevLink.setStyle("left",0);this.nextLink.addEvent("mouseover",function(a){this.focusControl(a,this.nextLink)}.bind(this));if(this.options.showCartButton){this.add2cartLink=new Element("a",{href:"#","class":"eventgallery-add2cart button-add2cart btn btn-primary",html:'<i class="big"></i>',id:"ajax-add2cartbuttoncount",styles:{"font-size":"59px",right:"0px","z-index":999,position:"absolute",display:"block",right:"10px",top:"10px"}});this.add2cartLink.hide();this.bigImage.getParent().grab(this.add2cartLink);$(document.body).fireEvent("updatecartlinks")}if(this.options.showCartConnector){this.cartConnectorLink=new Element("a",{href:"#","class":"button-cart-connector",html:'<i class="big"></i>',id:"ajax-cartconnector",rel:this.options.cartConnectorLinkRel,styles:{"font-size":"59px",right:"0px","z-index":999,position:"absolute",display:"block",right:"10px",top:"10px"}});this.bigImage.getParent().grab(this.cartConnectorLink)}if(this.options.showSocialMediaButton){this.socialmediabutton=new Element("a",{href:"#",rel:"nofollow","class":"social-share-button social-share-button-open",html:'<i class="big"></i>',id:"ajax-social-media-button",styles:{"font-size":"59px",right:"0px","z-index":999,position:"absolute",display:"block",left:"10px",top:"10px",width:"40px"}});this.bigImage.getParent().grab(this.socialmediabutton)}this.bigImage.addEvents({mousemove:this.mouseOverHandler.bind(this),mouseleave:this.mouseLeaveHandler.bind(this)});document.addEvent("keydown",this.keyboardHandler.bind(this));this.mouseLeaveHandler()},focusControl:function(a,b){b.setStyle("opacity",1)},mouseOverHandler:function(b){var a=this.thumbs.indexOf(this.selectedContainer);var d=this.bigImage.getSize().x;var c=0;if(a<this.thumbs.length-1){c=this.options.maxOpacity-this.getDistanceToMouse(this.nextLink,b)/d}this.nextLink.setStyle("opacity",c);c=0;if(a>0){c=this.options.maxOpacity-this.getDistanceToMouse(this.prevLink,b)/d}this.prevLink.setStyle("opacity",c);c=0;c=this.options.maxOpacity-this.getDistanceToMouse(this.zoomLink,b)/d*2;c=1;this.zoomLink.setStyle("opacity",c)},mouseLeaveHandler:function(){this.nextLink.setStyle("opacity",0);this.prevLink.setStyle("opacity",0);this.zoomLink.setStyle("opacity",0)},keyboardHandler:function(a){if(EventGalleryMediabox&&EventGalleryMediabox.isActive()&&eventGalleryMediaBoxImages&&eventGalleryMediaBoxImages[0][2]=="cart"){return}if(!this.blockKeys){if(a.code>=49&&a.code<=57){this.gotoPage(a.key-1)}else{if(a.key=="left"){this.prevImage(a)}else{if(a.key=="right"){this.nextImage(a)}}}}},getDistanceToMouse:function(a,d){var c=a.getSize();var e=Math.abs(d.client.x-(a.getLeft()+c.x/2));var b=Math.abs(d.client.y-(a.getTop()+c.y/2));return Math.sqrt(Math.pow(e,2)+Math.pow(b,2))},resetThumbs:function(){this.loadedImages=0;this.convertThumbs();this.loadNextImage();this.select(this.selectedContainer,true)},convertThumbs:function(){this.thumbs.each(function(b,a){this.convertThumb(b,a)},this)},convertThumb:function(b,a){if(!$defined(b)){return}b.addEvent("click",this.select.bind(this,b)).setStyle("position","relative").set("counter",a);b.getFirst().set("href","javascript: void(0);");b.addClass(this.options.loadingClass)},unBlockKeys:function(){this.blockKeys=false},select:function(b,g){g=typeof g!=="undefined"?g:false;if(this.blockKeys||!$defined(b)){return false}this.blockKeys=true;if($defined(this.selectedContainer)){if(b==this.selectedContainer&&!g){this.unBlockKeys();return false}this.deselect(this.selectedContainer)}var d=document.location;var c=d.toString().split("#");document.location.href=c[0]+"#"+this.thumbs.indexOf(b);var f=Math.floor((b.get("counter")-this.imagesPerFirstPage)/this.imagesPerPage)+1;if(this.currentPageNumber!=f){this.gotoPage(f,b)}this.selectedContainer=b;b.addClass(this.options.activeClass);var e=b.getFirst();if(this.options.showCartButton){this.add2cartLink.set("data-id",e.getAttribute("data-id"));$$(".eventgallery-add2cart").set("data-id",e.getAttribute("data-id"))}if(this.options.showCartConnector){this.cartConnectorLink.set("data-folder",e.getAttribute("data-folder"));this.cartConnectorLink.set("data-file",e.getAttribute("data-file"));this.cartConnectorLink.set("href",decodeURIComponent(e.getAttribute("data-cart-connector-link")))}if(this.options.showSocialMediaButton){this.socialmediabutton.set("data-link",decodeURIComponent(e.getAttribute("data-social-sharing-link")))}$(document.body).fireEvent("updatecartlinks");var a=e.longdesc;if(a==undefined){a=e.getAttribute("longDesc")}this.setImage(e.get("rel"),a,e.getAttribute("data-description"),e.getAttribute("data-title"))},loadNextImage:function(){if(!window.opera){var b=this.thumbs[this.loadedImages].getFirst();var a=b.get("rel");new Asset.image(a,{onload:this.imageLoaded.bind(this,this.thumbs[this.loadedImages])})}},imageLoaded:function(a){this.loadedImages++;a.removeClass(this.options.loadingClass);if(this.loadedImages<this.thumbs.length){this.loadNextImage()}},selectByIndex:function(a){if(a<0||this.thumbs.length<=a){a=0}this.select(this.thumbs[a])},deselect:function(a){a.removeClass(this.options.activeClass)},setImage:function(a,b,c,d){if(this.effect===undefined){this.effect=new Fx.Tween(this.bigImage,{duration:this.options.fadeSpeed,transition:Fx.Transitions.Quad.easeOut})}else{this.effect.cancel()}this.effect.start("opacity",0).chain(function(){this.bigImage.set("src",a);this.zoomLink.set("data-title",decodeURIComponent(d));this.zoomLink.set("href",b);EventGalleryMediabox.scanPage();try{if(eventGalleryMediaBoxImages&&eventGalleryMediaBoxChangeImage){eventGalleryMediaBoxImages[0][0]=this.zoomLink.get("href");eventGalleryMediaBoxImages[0][1]=this.zoomLink.getAttribute("data-title");eventGalleryMediaBoxChangeImage(0)}}catch(f){}if($defined($(this.options.titleTarget))){$(this.options.titleTarget).set("html",decodeURIComponent(c))}this.effect.start("opacity",1).chain(this.unBlockKeys.bind(this));try{pageTracker._trackPageview()}catch(f){}}.bind(this))},prevPage:function(){this.gotoPage(this.currentPageNumber-1)},nextPage:function(){this.gotoPage(this.currentPageNumber+1)},prevImage:function(a){a.stop();this.selectByIndex(this.thumbs.indexOf(this.selectedContainer)-1)},nextImage:function(a){a.stop();this.selectByIndex(this.thumbs.indexOf(this.selectedContainer)+1)},zoomImage:function(a){a.stop()},gotoPage:function(a,c){if(a==0){c=[c,this.thumbs[0]].pick()}else{c=[c,this.thumbs[(a-1)*this.imagesPerPage+this.imagesPerFirstPage]].pick()}if(a>=0&&a<this.lastPage){this.pageContainer.set("tween",{duration:this.options.pageSpeed,transition:Fx.Transitions.Quint.easeInOut});this.pageContainer.tween("margin-left",this.pageContainer.getLast().getSize().x*a*-1);var b=0;$(this.pageContainer).getChildren().each(function(e){var d=e.getSize().y;if(d>b){b=d}});this.pageContainer.setStyle("height",b);this.currentPageNumber=a;this.select(c);this.updateHandles()}},updateHandles:function(){if($defined(this.options.prevHandle)){new Fx.Tween(this.options.prevHandle,{link:"link",duration:this.options.fadeSpeed*2}).start("opacity",this.currentPageNumber==0?0:1)}if($defined(this.options.nextHandle)){new Fx.Tween(this.options.nextHandle,{link:"cancel",duration:this.options.fadeSpeed*2}).start("opacity",this.currentPageNumber==this.lastPage-1?0:1)}if($defined(this.options.countHandle)){this.updatePagingBar(this.options.countHandle,this.currentPageNumber,this.lastPage)}},updatePagingBar:function(a,f,c){if(a.innerHTML==""){for(var e=0;e<c;e++){this.createCountLink(this,a,e)}}var j=this.options.pageSpeed;if(c>9){for(var e=0;e<c;e++){$("count"+e).setStyle("display","inline")}var b=c;var h=0;var d=c-f-1;var g=f;if(g>4&&d>4){h=f-4;b=f+5}else{if(g<=4){h=0;b=f+5+(4-g)}if(d<=4){h=f-4-(4-d);b=c}}for(var e=0;e<h;e++){$("count"+e).setStyle("display","none")}for(var e=b;e<c;e++){$("count"+e).setStyle("display","none")}}a.getChildren(".active").removeClass("active");$("count"+f).addClass("active")},createCountLink:function(a,d,c){var e=new Element("a",{href:"#",html:c+1});e.addEvent("click",function(f){this.gotoPage(c);return false}.bind(a));var b=new Element("li",{"class":"count",id:"count"+c});d.grab(b.grab(e))}});